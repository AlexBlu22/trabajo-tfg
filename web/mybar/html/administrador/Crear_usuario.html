<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap CSS|JS -->
    <link href="../../bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <script src="../../bootstrap/js/bootstrap.bundle.min.js"></script>

    <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
        }

        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }
    </style>

    <!-- Personal CSS -->
    <link rel="stylesheet" type="text/css" href="../../css/colores_mybar.css" />
    <link rel="stylesheet" type="text/css" href="../../css/header.css" />

    <!-- Titulo/logo WEB -->
    <link rel="icon" type="image/png" href="../../image/logo/logo png/logo4.png" />
    <title>myBar · Bar</title>
</head>

<body>

    <!-- Barra de titulo -->
    <div class="px-3 py-2 mybar-background white">
        <div class="container">
            <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
                <a href="../web/index.html"
                    class="d-flex align-items-center my-2 my-lg-0 me-lg-auto text-white text-decoration-none">
                    <img class="mb-4" src="../../image/logo/logo png/logo4.png" alt="" width="60">
                </a>

                <ul class="nav col-12 col-lg-auto my-2 justify-content-center my-md-0 text-small">

                    <li>
                        <a href="administrador.html" class="nav-link text-white">
                            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="" fill="currentColor" class="bi bi-reply-fill" viewBox="0 0 16 16">
                                <path
                                    d="M5.921 11.9 1.353 8.62a.719.719 0 0 1 0-1.238L5.921 4.1A.716.716 0 0 1 7 4.719V6c1.5 0 6 0 7 8-2.5-4.5-7-4-7-4v1.281c0 .56-.606.898-1.079.62z" />
                            </svg>
                        </a>
                    </li>

                </ul>
            </div>
        </div>
    </div>

    <!-- Cuerpo de la pagina -->

    <div class="container">
        <a href="javascript: history.go(-1)"><h1 class="p-2 bd-highlight"><i class="bi bi-arrow-left"></i></h1></a>
        <h1>Añadir Usuario</h1>
  
          <div class="row">
          </div>
          <div class="row">
            <div class="col-md-4">
              <label for="usuario" class="form-label">Nombre del usuario</label>
              <input type="text" class="form-control" id="usuario" name="usuario" required />
            </div>
            <div class="col-md-4">
              <label for="correo" class="form-label">correo</label>
              <input type="text" class="form-control" id="correo" name="correo" required />
            </div>
          </div>
          <div class="row">
            <div class="col-md-4">
              <label for="contrasena" class="form-label">contraseña</label>
              <input type="text" class="form-control" id="contrasena" name="contrasena" required />
            </div>
            <div hidden class="col-md-4">
              <label for="id_tipo_usurio" class="form-label">Tipo usuario</label>
              <input type="text" class="form-control" id="id_tipo_usurio" name="id_tipo_usurio" value=3 required />
            </div>    
          </div>
            <div class="col-md-4">
          </div>
          <div class="row mt-3">
            <div class="col-12">
              <button id="idSalvar" class="col-4 btn btn-primary" onclick="fVerificarAltaUsurio()">Añadir usuario</button>
              <button id="idCancel" class="col-2 btn btn-warning" onclick="fCancelarAltaUsuario()">Cancelar</button>
            </div>
          </div>
  
        <!-- Modal para mensajes -->
        <div class="modal" id="idModal" tabindex="-1">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h1 id="idMdlTitle" class="modal-title">Mensaje</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <p id="idMdlMsg">Modal body text goes here.</p>
              </div>
              <div class="modal-footer">
                <button id="idMdlClose" type="button" class="btn" style="background-color: #ffc107;" data-bs-dismiss="modal">Cerrar</button>
                <button id="idMdlOK" type="button" class="btn btn-primary">OK</button>
              </div>
            </div>
          </div>
        </div>

        <p style="color: red" id="CajaMensajes"></p>

      </div>
  
      <!--<script src="js/editCliente.js"></script> -->

    <!-- Pie de pagina -->
    <div class="container">
        <footer class="footer d-flex justify-content-between align-items-center py-3 my-4 border-top">
            <p class="col-md-4 mb-0 text-muted">&copy; myBar / 2022</p>

            <ul class="nav col-md-4 justify-content-end">
                <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">Home</a></li>
                <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">Features</a></li>
                <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">Pricing</a></li>
                <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">FAQs</a></li>
                <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">About</a></li>
            </ul>
        </footer>
    </div>


    <script>

      function fVerificarAltaUsurio(){
  
          let sUser = document.getElementById('usuario').value;
          let sEMail = document.getElementById('correo').value;
          let sPass = document.getElementById('contrasena').value;
          let vTipo_usuario = document.getElementById('id_tipo_usurio').value;
          let vDataPost = {};

          let bCrearUsuario = true;
 
          if (sUser == "" && bCrearUsuario) {
              document.getElementById("CajaMensajes").innerHTML = "Usuario no indicado ...";
              bCrearUsuario = false;
          } 
          if (sEMail == "" && bCrearUsuario) {
              document.getElementById("CajaMensajes").innerHTML = "eMail no indicado ...";
              bCrearUsuario = false;
          }
          if (sPass == "" && bCrearUsuario) {
              document.getElementById("CajaMensajes").innerHTML = "Password no indicada ...";
              bCrearUsuario = false;
          } 
  
          if ( bCrearUsuario ) {
            
            let sCadenaInvocacionServlet = "http://localhost:3000/sesion/creacion";
            console.log( sCadenaInvocacionServlet );
            console.log( "(" + sUser + ") (" + sEMail + ") (" + sPass + ") (" + vTipo_usuario + ")" );
            //alert( sCadenaInvocacionServlet );
            //alert( "(" + sUser + ") (" + sEMail + ") (" + sPass + ") (" + vTipo_usuario + ")" );
            
            vDataPost = {
                          "usuario": sUser,
                          "correo": sEMail,
                          "contrasena": sPass,
                          "id_tipo_usuario": 3
                        }
            
            //alert( vDataPost.usuario );
            //alert( vDataPost.correo );
            //alert( vDataPost.contrasena );
            //alert( vDataPost.id_tipo_usuario );
            console.log( vDataPost );

            fetch(sCadenaInvocacionServlet,
                   { 
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(vDataPost)
                   }  
                 )
                .then( (response) => { 
                                       console.log( response );
                                       return response.json(); 
                                     }
                     )
                .then( (data) => { 
                                    console.log( 'Return data' );
                                    console.log( data ); 
                                    console.log( 'Longitud' );
                                    console.log( data.result.length );
                                    if( data.result.length > 0 ) {
                                        console.log( "Usuario creado ")
                                    } else {
                                        console.log( "Usuario no creado ...");
                                    }
                                 }
                     )
                .catch( (error) => { console.log("Invocación erronea ....");
                                     console.log( console.log(error) );
                                   } );

              alert( "(" + sUser + ") (" + sEMail + ") (" + sPass + ") (" + vTipo_usuario + ")")
              document.getElementById("CajaMensajes").innerHTML = ""; 
              //window.location="http://127.0.0.1:5500/web/mybar/html/administrador/administrador.html";
  
          }
  
      }

      function fCancelarAltaUsuario(){
          document.getElementById('usuario').value = "";
          document.getElementById('correo').value  = "";
          document.getElementById('contrasena').value  = "";
          document.getElementById("CajaMensajes").innerHTML = "";
      }  
      
  </script>

</body>

</html>