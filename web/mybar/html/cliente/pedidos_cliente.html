<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap CSS|JS -->
    <link href="../../bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <script src="../../bootstrap/js/bootstrap.bundle.min.js"></script>

    <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
        }

        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }
    </style>

    <!-- Personal CSS -->
    <link rel="stylesheet" type="text/css" href="../../css/colores_mybar.css" />

    <!-- Titulo/logo WEB -->
    <link rel="icon" type="image/png" href="../../image/logo/logo png/logo4.png" />
    <title>myBar Â· Pedidos</title>
</head>

<body>

    <!-- Barra de titulo -->
    <main>
        <nav class="navbar navbar-dark mybar-background white" aria-label="First navbar example">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <p class="h1"><img class="" src="../../image/logo/logo png/logo4.png" alt="" width="50"> Pedidos</p>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarsExample01" aria-controls="navbarsExample01" aria-expanded="false"
                    aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Enlaces dentro del colaps -->
                <div class="collapse navbar-collapse" id="navbarsExample01">
                    <ul class="navbar-nav me-auto mb-2">

                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="../cliente/cliente.v2.html">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                    class="bi bi-house" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd"
                                        d="M2 13.5V7h1v6.5a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5V7h1v6.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5zm11-11V6l-2-2V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5z" />
                                    <path fill-rule="evenodd"
                                        d="M7.293 1.5a1 1 0 0 1 1.414 0l6.647 6.646a.5.5 0 0 1-.708.708L8 2.207 1.354 8.854a.5.5 0 1 1-.708-.708L7.293 1.5z" />
                                </svg>
                                Home
                            </a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="../cliente/mostrar_bares.html">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="" fill="currentColor"
                                    class="bi bi-bank" viewBox="0 0 16 16">
                                    <path
                                        d="M8 .95 14.61 4h.89a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5H15v7a.5.5 0 0 1 .485.379l.5 2A.5.5 0 0 1 15.5 17H.5a.5.5 0 0 1-.485-.621l.5-2A.5.5 0 0 1 1 14V7H.5a.5.5 0 0 1-.5-.5v-2A.5.5 0 0 1 .5 4h.89L8 .95zM3.776 4h8.447L8 2.05 3.776 4zM2 7v7h1V7H2zm2 0v7h2.5V7H4zm3.5 0v7h1V7h-1zm2 0v7H12V7H9.5zM13 7v7h1V7h-1zm2-1V5H1v1h14zm-.39 9H1.39l-.25 1h13.72l-.25-1z" />
                                </svg>
                                Todos los bares
                            </a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link disabled" href="../cliente/pedidos_cliente.html">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="" fill="currentColor"
                                    class="bi bi-card-list" viewBox="0 0 16 16">
                                    <path
                                        d="M14.5 3a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-13a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h13zm-13-1A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13z" />
                                    <path
                                        d="M5 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 5 8zm0-2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm0 5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm-1-5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0zM4 8a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0zm0 2.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0z" />
                                </svg>
                                Pedidos realizados
                            </a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link disabled">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="" fill="currentColor"
                                    class="bi bi-nut-fill" viewBox="0 0 16 16">
                                    <path
                                        d="M4.58 1a1 1 0 0 0-.868.504l-3.428 6a1 1 0 0 0 0 .992l3.428 6A1 1 0 0 0 4.58 15h6.84a1 1 0 0 0 .868-.504l3.429-6a1 1 0 0 0 0-.992l-3.429-6A1 1 0 0 0 11.42 1H4.58zm5.018 9.696a3 3 0 1 1-3-5.196 3 3 0 0 1 3 5.196z" />
                                </svg>
                                Configuracion
                            </a>
                        </li>

                    </ul>

                </div>
            </div>
        </nav>
    </main>

    <!-- Cabeza pagina -->
  <div id="cabeza_pa">

    <!-- Navegador sencillo -->
    <div class="text-center mybar-background white">
      <div class="text-white fs-1">
        Informacion de mis pedidos
      </div>
    </div>

  </div>

  <div class="container">
    <table class="table table-responsive table-sm">
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">bar</th>
          <th scope="col">comida</th>
          <th scope="col">alergenos</th>
          <th scope="col">precio</th>
          <th scope="col">cantidad</th>
          <th scope="col">preparado</th>
        </tr>
      </thead>
      <tbody id="id_tablaProductos"></tbody>
    </table>

    <p style="color: red" id="CajaMensajes">___</p>

    <!-- Modal para mensajes -->
    <div class="modal" id="idModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1 id="idMdlTitle" class="modal-title">Mensaje</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p id="idMdlMsg">Modal body text goes here.</p>
          </div>
          <div class="modal-footer">
            <button id="idMdlClose" type="button" class="btn" style="background-color: #ffc107" data-bs-dismiss="modal">
              Cerrar
            </button>
            <button id="idMdlOK" type="button" class="btn btn-primary">OK</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal para wait -->
    <div class="modal" id="idModalWait" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-body d-flex justify-content-center">
            <div class="loader"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Pie de pagina -->
  <div class="container">
    <footer class="footer d-flex justify-content-between align-items-center py-3 my-4 border-top">
      <p class="col-md-4 mb-0 text-muted">&copy; myBar / 2022</p>

      <ul class="nav col-md-4 justify-content-end">
        <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">Home</a></li>
        <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">Features</a></li>
        <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">Pricing</a></li>
        <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">FAQs</a></li>
        <li class="nav-item"><a href="#" class="nav-link px-2 text-muted">About</a></li>
      </ul>
    </footer>
  </div>

  <script>

    let bDatosCabecera = false;
    let sUsuario = 0;

    if (window.location.search != "") {

      bDatosCabecera = true;

      const queryStr = window.location.search.substring(1);
      let parametro  = queryStr.split("=");
      sUsuario  = parametro[1];

      console.log( "Usuario:" );
      console.log( sUsuario );
          
      //Simular con datos de un bar y un pedido con datos
        //sUsuario = "Jordain";

    } else {
      bDatosCabecera = false ;

      console.log( "Sin datos en la cabecera HTML ...");
      document.getElementById("CajaMensajes").innerHTML = "Sin datos en la cabecera HTML ...";

  } 

  if( bDatosCabecera ) {

    document.getElementById("CajaMensajes").innerHTML = "";

    let sCadenaInvocacionServlet = "http://localhost:3000/usuarios/pedidos";
    console.log( sCadenaInvocacionServlet );
    
    fetch(sCadenaInvocacionServlet)
    .then( (response) => { return response.json(); })
    .then( (data) => { 
                        console.log( 'Return data' );
                        console.log( data ); 
                        if( data.result.length > 0 ) {
                            console.log( 'Longitud' );
                            console.log( data.result.length );
                          
                            let tblBody = document.getElementById("id_tablaProductos");
                            let nRegistros = data.result.length;

                            for ( var nRegistrosJSON = 0; nRegistrosJSON <= (nRegistros-1); nRegistrosJSON++) {
                                  //console.log( 'InformaciÃ³n:' );

                                  console.log( "Verficar cada pedido del usuario ... ");
                                  console.log( sUsuario);
                                  console.log( data.result[nRegistrosJSON].usuario );

                                  if( (sUsuario == data.result[nRegistrosJSON].usuario) )  {

                                    let fila = document.createElement("tr");
                                    let elemento = document.createElement("td");
                                    elemento.innerHTML = data.result[nRegistrosJSON].id_bar;
                                    fila.appendChild( elemento );
                      
                                    elemento = document.createElement("td");
                                    elemento.innerHTML = data.result[nRegistrosJSON].nombre;
                                    fila.appendChild(elemento);
                      
                                    elemento = document.createElement("td");
                                    elemento.innerHTML = data.result[nRegistrosJSON].direccion;
                                    fila.appendChild(elemento);
                      
                                    elemento = document.createElement("td");
                                    elemento.innerHTML = data.result[nRegistrosJSON].telefono;
                                    fila.appendChild(elemento);
                      
                                    elemento = document.createElement("td");
                                    elemento.innerHTML = data.result[nRegistrosJSON].comida;
                                    fila.appendChild(elemento);
                      
                                    elemento = document.createElement("td");
                                    elemento.innerHTML = data.result[nRegistrosJSON].alergenos;
                                    fila.appendChild(elemento);
                      
                                    elemento = document.createElement("td");
                                    elemento.innerHTML = data.result[nRegistrosJSON].precio;
                                    fila.appendChild(elemento);
                      
                                    tblBody.appendChild(fila);
                                  };

                            };

                        } else {
                            console.log( "Sin informaciÃ³n de pedidos en el bar ...")
                            document.getElementById("CajaMensajes").innerHTML = "Sin informaciÃ³n de pedidos para el cliente ...";
                            //alert( "Usuario sin datos de tipo usuario ..." );
                        };

                     }
         )
    .catch( (error) => { console.log(error); });

  };

</script>
  
</body>

</html>